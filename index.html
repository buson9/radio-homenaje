<button class="btn-main" onclick="togglePlayback()" id="play-btn">ESPERANDO SEÃ‘AL...</button>

    <div class="donation-box">
        <span style="font-size: 0.9rem; color: var(--gold); font-weight: bold;">APOYA EL PROYECTO</span>
        <img src="takenos.png" alt="DonaciÃ³n QR" class="qr-img">
        <p style="font-size: 0.8rem; margin-top: 10px;">Escanea para aportar</p>
    </div>

    <script>
        let player;
        let playing = false;
        const playlistId = 'PLZqJ_GcvNCE5YIWhR6RKb9pyHITolrwMn';

        // Carga de API YouTube corregida
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                playerVars: {
                    listType: 'playlist',
                    list: playlistId,
                    autoplay: 0,
                    controls: 0,
                    disablekb: 1,
                    modestbranding: 1,
                    rel: 0,
                    loop: 1
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            const btn = document.getElementById('play-btn');
            btn.classList.add('active');
            btn.innerText = "SINTONIZAR EMISORA";
            player.setShuffle(true);
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                const videoData = player.getVideoData();
                document.getElementById('song-title').innerText = "Vibrando con: " + videoData.title;
            }
            if (event.data === YT.PlayerState.ENDED) { player.nextVideo(); }
        }

        function togglePlayback() {
            const arm = document.getElementById('arm');
            const disc = document.getElementById('disc');
            const btn = document.getElementById('play-btn');
            const nextBtn = document.getElementById('next-btn');

            if (!playing) {
                arm.style.transform = 'rotate(-18deg)'; 
                disc.style.animationPlayState = 'running';
                player.playVideoAt(Math.floor(Math.random() * 20)); 
                document.body.classList.add('amber-mode');
                btn.innerText = "APAGAR RADIO";
                nextBtn.style.display = 'block';
                playing = true;
                spawnDecorations();
            } else {
                arm.style.transform = 'rotate(25deg)'; 
                disc.style.animationPlayState = 'paused';
                player.pauseVideo();
                document.body.classList.remove('amber-mode');
                btn.innerText = "SINTONIZAR EMISORA";
                nextBtn.style.display = 'none';
                document.getElementById('song-title').innerText = "";
                playing = false;
            }
        }

        function nextVideo() { if(player) player.nextVideo(); }

        function setView(m) {
            document.getElementById('radio-stage').style.display = m === 'radio' ? 'block' : 'none';
            document.getElementById('tv-stage').style.display = m === 'tv' ? 'block' : 'none';
        }

        function spawnDecorations() {
            if (!playing) return;
            const deco = document.createElement('div');
            deco.className = 'decoration';
            const icons = ['â™ª', 'â™«', 'ðŸ“»', 'âœ¨', 'ðŸ’¿', 'ðŸŽ§', 'ðŸ”Š'];
            deco.innerHTML = icons[Math.floor(Math.random() * icons.length)];
            deco.style.left = Math.random() * 100 + 'vw';
            deco.style.bottom = '20px';
            document.body.appendChild(deco);
            setTimeout(() => deco.remove(), 4000);
            setTimeout(spawnDecorations, 700);
        }
    </script>
</body>
</html>
